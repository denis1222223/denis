<template id="template">

    <style>
        .spinner-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%)
        }

        .spinner {
            width: 30px;
            height: 30px;
            background-color: #655488;

            -webkit-animation: sk-rotateplane 1.2s infinite ease-in-out;
            animation: sk-rotateplane 1.2s infinite ease-in-out;
        }

        @-webkit-keyframes sk-rotateplane {
            0% { -webkit-transform: perspective(120px) }
            50% { -webkit-transform: perspective(120px) rotateY(180deg) }
            100% { -webkit-transform: perspective(120px) rotateY(180deg)  rotateX(180deg) }
        }

        @keyframes sk-rotateplane {
            0% {
                transform: perspective(120px) rotateX(0deg) rotateY(0deg);
                -webkit-transform: perspective(120px) rotateX(0deg) rotateY(0deg)
            }
            50% {
                transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
                -webkit-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg)
            }
            100% {
                transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
                -webkit-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
            }
        }
    </style>

    <div class="spinner-wrapper">
        <div class="spinner"></div>
    </div>
</template>

<script>
    (function(window, document) {
        var ownerDocument =  (document._currentScript || document.currentScript).ownerDocument;
        var template = ownerDocument.querySelector('#template').content;

        var elementPrototype = Object.create(HTMLElement.prototype);

        elementPrototype.createdCallback = function() {
            this._count = 1;
            var shadowRoot = this.createShadowRoot();
            var clone = document.importNode(template, true);
            shadowRoot.appendChild(clone);
        };

        elementPrototype.show = function() {
            if (this._count === 0) {
                this.removeAttribute("hidden");
            }
            this._count++;
        };

        elementPrototype.hide = function() {
            if (this._count > 0) {
                this._count--;
            }
            if (this._count === 0) {
                this.setAttribute("hidden", true);
            }
        };

        document.registerElement('x-spinner', {prototype: elementPrototype });
    })(window, document);
</script>